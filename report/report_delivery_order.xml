<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="action_report_delivery_order_mini" model="ir.actions.report">
        <field name="name">Custom Delivery Order</field>
        <field name="model">stock.picking</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">rj_invoice.report_delivery_order_mini_template</field>
        <field name="report_file">rj_invoice.report_delivery_order_mini_template</field>
        <field name="paperformat_id" ref="rj_invoice.paperformat_invoice_a5_custom"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="binding_type">report</field>
    </record>

    <template id="report_delivery_order_mini_template">
        <t t-call="web.html_container">
        <meta charset="utf-8"/>
            <t t-foreach="docs" t-as="doc">
                <style>
                    @page {
                        size: 20cm 27.94cm;
                        margin: 0.4cm;
                    }
                    body {
                        margin: 0;
                        <!-- font-family: "Consolas", "Lucida Console", "Liberation Mono", monospace; -->
                        font-family: "FreeMono", "Courier New", monospace;
                    }
                    table {
                        border-collapse: collapse;
                        width: 100%;
                    }
                    th, td {
                        border: 1px solid #000;
                        padding: 3px;
                    }
                    .no-border td {
                        border: none !important;
                    }
                </style>

                <div class="page" style="font-size: 12pt; line-height: 1.3;">
                    <table class="no-border" style="font-size: 12pt; width:100%;">
                        <tr>
                            <td class="no-border" style="width: 40%; text-align: left;">
                                <t t-if="doc.company_id.name">
                                    <div style="font-size: 13pt;">
                                        <strong><t t-esc="doc.company_id.name"/></strong>
                                    </div>
                                </t>
                            </td>
                            <td class="no-border" style="width: 25%; text-align: center;">
                                <div style="font-size: 13pt; font-weight: bold;">
                                    SURAT JALAN
                                </div>
                            </td>
                            <td class="no-border" style="width: 35%; text-align: right; font-size: 13pt;">
                                <t t-if="doc.custom_sequence">
                                    <div>
                                        <strong>SEQ: <t t-esc="doc.custom_sequence"/></strong>
                                    </div>
                                </t>
                            </td>
                        </tr>
                    </table>
                    <hr style="border: 0; border-top: 1px solid #000; margin: 3px 0; width:100%;" />
                    <table class="no-border" style="font-size: 12pt; width:100%;">
                        <tr>
                            <td style="vertical-align: top; width: 80%;">

                                <t t-set="invoice_partner"
                                t-value="
                                        doc.sale_id.partner_invoice_id
                                        if doc.sale_id and doc.sale_id.partner_invoice_id
                                        else doc.partner_id
                                "/>

                                <table class="no-border" style="font-size: 12pt; width:100%;">
                                    <tr>
                                        <td style="padding:0; margin:0;">
                                            <strong>Kepada Yth:</strong>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="padding:0; margin:0;">
                                            <t t-esc="invoice_partner.display_name or ''"/>
                                        </td>
                                    </tr>

                                    <t t-if="invoice_partner.street">
                                        <tr>
                                            <td style="padding:0; margin:0;">
                                                <t t-esc="invoice_partner.street"/>
                                            </td>
                                        </tr>
                                    </t>

                                    <t t-if="invoice_partner.street2">
                                        <tr>
                                            <td style="padding:0; margin:0;">
                                                <t t-esc="invoice_partner.street2"/>
                                            </td>
                                        </tr>
                                    </t>
                                    
                                    <!-- <t t-set="parts" t-value="[
                                        invoice_partner.city or '',
                                        invoice_partner.state_id.name if invoice_partner.state_id else '',
                                        invoice_partner.zip or '',
                                        ('\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0 Telp. %s' % invoice_partner.phone) if invoice_partner.phone else ''
                                    ]"/>

                                    <t t-set="clean_parts" t-value="[p for p in parts if p]"/>

                                    <t t-if="clean_parts">
                                        <tr>
                                            <td style="padding:0; margin:0;">
                                                <t t-raw="' - '.join(clean_parts)"/>
                                            </td>
                                        </tr>
                                    </t> -->
                                    <t t-set="location_parts" t-value="[
                                        invoice_partner.city or '',
                                        invoice_partner.state_id.name if invoice_partner.state_id else '',
                                        invoice_partner.zip or ''
                                    ]"/>

                                    <t t-set="clean_location" t-value="[p for p in location_parts if p]"/>

                                    <t t-set="phone_part"
                                    t-value="('\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0Telp. %s' % invoice_partner.phone)
                                                if invoice_partner.phone else ''"/>

                                    <t t-if="clean_location or phone_part">
                                        <tr>
                                            <td style="padding:0; margin:0;">
                                                <t t-raw="' - '.join(clean_location) + phone_part"/>
                                            </td>
                                        </tr>
                                    </t>


                                </table>
                            </td>

                            <td style="vertical-align: top; width: 20%; text-align: right; font-size: 12pt;">
                                <t t-esc="doc.name"/>
                            </td>
                        </tr>
                    </table>

                    <table class="no-border" style="font-size:12pt; width:100%; margin-top:5px;">
                        <tr>
                            <td style="padding:0; margin:0; font-weight:bold;">
                                <t t-if="doc.picking_type_id.code == 'outgoing'">
                                    Alamat Pengiriman:
                                </t>
                                <t t-else="">
                                    Warehouse Address:
                                </t>
                            </td>
                        </tr>

                        <t t-if="doc.picking_type_id.code == 'outgoing'">
                            <t t-set="shipping" t-value="doc.partner_id"/>

                            <tr>
                                <td style="padding:0; margin:0;">
                                    <t t-set="partner_name"
                                        t-value="', '.join(filter(None, [
                                            (shipping.parent_id.name if shipping.parent_id and shipping.parent_id.name != shipping.name else ''),
                                            shipping.name
                                    ]))"/>
                                    <t t-raw="partner_name"/>
                                </td>
                            </tr>

                            <t t-if="shipping.street">
                                <tr><td style="padding:0; margin:0;"><t t-esc="shipping.street"/></td></tr>
                            </t>

                            <t t-if="shipping.street2">
                                <tr><td style="padding:0; margin:0;"><t t-esc="shipping.street2"/></td></tr>
                            </t>

                            <!-- <t t-set="city" t-value="str(shipping.city or '').strip()"/>
                            <t t-set="state" t-value="str(shipping.state_id.name if shipping.state_id else '').strip()"/>
                            <t t-set="zip_code" t-value="str(shipping.zip or '').strip()"/>

                            <t t-set="phone"
                                t-value="('\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0 Telp. %s' % shipping.phone) if shipping.phone else ''"/>

                            <t t-set="location"
                                t-value="' - '.join([str(x) for x in [city, state, zip_code, phone] if x])"/>

                            <t t-if="location">
                                <tr><td style="padding:0; margin:0;"><t t-esc="location"/></td></tr>
                            </t> -->

                            <t t-set="city" t-value="str(shipping.city or '').strip()"/>
                            <t t-set="state" t-value="str(shipping.state_id.name if shipping.state_id else '').strip()"/>
                            <t t-set="zip_code" t-value="str(shipping.zip or '').strip()"/>

                            <!-- Gabung lokasi saja -->
                            <t t-set="location_parts"
                            t-value="[x for x in [city, state, zip_code] if x]"/>

                            <!-- Telp ditempel setelah ZIP -->
                            <t t-set="phone_part"
                            t-value="('\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0Telp. %s' % shipping.phone)
                                        if shipping.phone else ''"/>

                            <t t-if="location_parts or phone_part">
                                <tr>
                                    <td style="padding:0; margin:0;">
                                        <t t-raw="' - '.join(location_parts) + phone_part"/>
                                    </td>
                                </tr>
                            </t>

                        </t>

                        <t t-else="">
                            <tr><td style="padding:0; margin:0;"><t t-esc="doc.company_id.name"/></td></tr>

                            <t t-if="doc.company_id.street">
                                <tr><td style="padding:0; margin:0;"><t t-esc="doc.company_id.street"/></td></tr>
                            </t>

                            <t t-if="doc.company_id.street2">
                                <tr><td style="padding:0; margin:0;"><t t-esc="doc.company_id.street2"/></td></tr>
                            </t>

                            <t t-set="city" t-value="str(doc.company_id.city or '').strip()"/>
                            <t t-set="state" t-value="str(doc.company_id.state_id.name if doc.company_id.state_id else '').strip()"/>
                            <t t-set="zip_code" t-value="str(doc.company_id.zip or '').strip()"/>

                            <t t-set="phone"
                                t-value="('\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0 Telp. %s' % company_id.phone) if company_id.phone else ''"/>

                            <t t-set="location"
                                t-value="' - '.join([str(x) for x in [city, state, zip_code, phone] if x])"/>

                            <t t-if="location">
                                <tr><td style="padding:0; margin:0;"><t t-esc="location"/></td></tr>
                            </t>

                            <!-- <t t-if="doc.company_id.phone">
                                <tr><td style="padding:0; margin:0;">Telp. <t t-esc="doc.company_id.phone"/></td></tr>
                            </t> -->
                        </t>
                    </table>

                    <table class="no-border" style="width:100%; font-size:12pt; margin-top:7px;">
                        <tr>
                            <t t-if="doc.po_customer">
                                <td style="text-align:left; padding:0; margin:0;">
                                    PO: <t t-esc="doc.po_customer"/>
                                </td>
                                <t t-if="doc.origin">
                                    <td style="text-align:center; padding:0; margin:0;">
                                        Order: <t t-esc="doc.origin"/>
                                    </td>
                                </t>
                                <td style="text-align:right; padding:0; margin:0;">
                                    Shipping Date:
                                    <t t-if="doc.state == 'done' and doc.date_done and not isinstance(doc.date_done, bool)">
                                        <t t-esc="doc.date_done.strftime('%d-%m-%Y')"/>
                                    </t>
                                    <t t-elif="doc.scheduled_date and not isinstance(doc.scheduled_date, bool)">
                                        <t t-esc="doc.scheduled_date.strftime('%d-%m-%Y')"/>
                                    </t>
                                </td>
                            </t>

                            <t t-else="">
                                <t t-if="doc.origin">
                                    <td style="text-align:left; padding:0; margin:0;">
                                        Order: <t t-esc="doc.origin"/>
                                    </td>
                                </t>
                                <t t-if="(doc.state == 'done' and doc.date_done and not isinstance(doc.date_done, bool))
                                        or (doc.scheduled_date and not isinstance(doc.scheduled_date, bool))">
                                    <td style="text-align:center; padding:0; margin:0;">
                                        Shipping Date:
                                        <t t-if="doc.state == 'done' and doc.date_done and not isinstance(doc.date_done, bool)">
                                            <t t-esc="doc.date_done.strftime('%d-%m-%Y')"/>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="doc.scheduled_date.strftime('%d-%m-%Y')"/>
                                        </t>
                                    </td>
                                </t>
                            </t>
                        </tr>
                    </table>

                    <table class="table-bordered" style="width:100%; font-size:12pt; border-collapse:collapse; margin-top:6px;" border="1">
                        <thead>
                            <tr>
                                <th style="width:5%; text-align:center; padding:4px;">No</th>
                                <th style="width:55%; text-align:center; padding:4px;">Product</th>
                                <th style="width:20%; text-align:center; padding:4px;">Ordered</th>
                                <th style="width:20%; text-align:center; padding:4px;">Delivered</th>
                            </tr>
                        </thead>

                        <t t-set="index" t-value="0"/>
                        <tbody>
                            <t t-foreach="doc.move_ids" t-as="l">
                                <t t-set="index" t-value="index + 1"/>

                                <tr>
                                    <td style="text-align:center; padding:4px;">
                                        <t t-esc="index"/>
                                    </td>

                                    <td style="text-align:left; padding:4px;">
                                        <t t-esc="(l.product_id.name or '')[:50]"/>
                                    </td>

                                    <td style="text-align:center; padding:4px;">
                                        <t t-out="'{:,.0f} {}'.format(l.product_uom_qty or 0, l.product_uom.name or '')"/>
                                    </td>

                                    <td style="text-align:center; padding:4px;">
                                        <t t-out="'{:,.0f} {}'.format(l.quantity_done or 0, l.product_uom.name or '')"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>

                    <t t-if="doc.no_seri or doc.keterangan">
                        <table style="width:100%; font-size:12pt; border-collapse:collapse; margin-top:5px;" border="1">
                            <t t-if="doc.no_seri">
                                <tr>
                                    <td style="padding:6px; text-align:left;">
                                        <strong>NO SERI:</strong>
                                        <t t-esc="doc.no_seri"/>
                                    </td>
                                </tr>
                            </t>

                            <t t-if="doc.keterangan">
                                <tr>
                                    <td style="padding:6px; text-align:left;">
                                        <strong>KETERANGAN:</strong>
                                        <t t-esc="doc.keterangan"/>
                                    </td>
                                </tr>
                            </t>
                        </table>
                    </t>

                    <t t-if="(doc.no_polisi_id and doc.no_polisi_id.name) or (doc.driver_id and doc.driver_id.name)">
                        <table class="table-bordered" style="width:100%; font-size:12pt; border-collapse:collapse; margin-top:8px;" border="1">
                            <tr>
                                <td style="text-align:left; padding:6px; width:50%;">
                                    <t t-if="doc.no_polisi_id and doc.no_polisi_id.name">
                                        No. Polisi: <t t-esc="doc.no_polisi_id.name"/>
                                    </t>
                                </td>
                                <td style="text-align:left; padding:6px; width:50%;">
                                    <t t-if="doc.driver_id and doc.driver_id.name">
                                        Driver: <t t-esc="doc.driver_id.name"/>
                                    </t>
                                </td>
                            </tr>
                        </table>
                    </t>

                    <table class="no-border" style="width:100%; margin-top:5px;">
                        <tr>
                            <td style="text-align:center; font-weight:bold;">
                                BARANG TELAH DITERIMA DENGAN BAIK DAN CUKUP
                            </td>
                        </tr>
                    </table>

                    <table class="no-border" style="width:100%; font-size:12pt;">
                        <tr>
                            <td style="text-align:center; vertical-align:bottom; width:33%;">
                                Admin
                            </td>
                            <td style="text-align:center; vertical-align:bottom; width:34%;">
                                Pengirim
                            </td>
                            <td style="text-align:center; vertical-align:bottom; width:33%;">
                                Penerima
                            </td>
                        </tr>
                    </table>

                </div>
            </t>
        </t>
    </template>
</odoo>